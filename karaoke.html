<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
<link as="style" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Lexend:wght@400;500;600;700;900&amp;family=Noto+Sans:wght@400;500;700;900" onload="this.rel='stylesheet'" rel="stylesheet"/>
<title>Karaoke Lector</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<style type="text/tailwindcss">
  :root {
    --primary-color: #0c7ff2;
    --secondary-color: #f0f2f5;
    --text-primary: #111418;
    --text-secondary: #525866;
    --highlight-correct: #FFFBEB;
    --highlight-omission: #FFF3E0;
  }
  .word { padding:0.125rem 0.25rem; margin:0.125rem; border-radius:0.25rem; transition:background-color 0.3s ease-in-out; display:inline-block; }
  .correct { background-color: var(--highlight-correct); }
  .omission { background-color: var(--highlight-omission); }
</style>
</head>
<body class="bg-gray-50 text-[var(--text-primary)]" style='font-family: Lexend, "Noto Sans", sans-serif;'>
<div class="relative flex size-full min-h-screen flex-col overflow-x-hidden">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[var(--secondary-color)] bg-white px-6 sm:px-10 py-4 shadow-sm">
  <div class="flex items-center gap-3 text-[var(--text-primary)]">
    <div class="size-7 text-[var(--primary-color)]">
      <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"><path d="M4 42.4379C4 42.4379 14.0962 36.0744 24 41.1692C35.0664 46.8624 44 42.2078 44 42.2078L44 7.01134C44 7.01134 35.068 11.6577 24.0031 5.96913C14.0971 0.876274 4 7.27094 4 7.27094L4 42.4379Z" fill="currentColor"/></svg>
    </div>
    <h1 class="text-xl font-bold tracking-tight">EduRead</h1>
  </div>
</header>
<main class="px-4 sm:px-8 md:px-16 lg:px-24 xl:px-40 flex flex-1 justify-center py-8">
  <div class="layout-content-container flex flex-col w-full max-w-4xl bg-white p-6 sm:p-8 rounded-xl shadow-lg">
    <div class="flex flex-wrap justify-between items-center gap-4 mb-6 pb-4 border-b border-[var(--secondary-color)]">
      <h2 class="text-2xl sm:text-3xl font-bold">Karaoke Lector</h2>
    </div>
    <select id="cancion" class="border p-2 mb-4 w-full"></select>
    <p id="letra" class="text-lg sm:text-xl font-normal leading-relaxed sm:leading-loose"></p>
    <div class="mt-8 pt-6 border-t border-[var(--secondary-color)] flex justify-end gap-4">
      <button id="iniciar" class="bg-[var(--primary-color)] text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-blue-600 transition-colors shadow-md">Iniciar</button>
      <button id="finalizar" class="hidden bg-[var(--primary-color)] text-white font-semibold py-2.5 px-6 rounded-lg hover:bg-blue-600 transition-colors shadow-md">Finalizar</button>
    </div>
  </div>
</main>
<footer class="bg-white border-t border-[var(--secondary-color)] py-6 px-10 text-center mt-auto">
  <p class="text-sm text-[var(--text-secondary)]">Â© 2024 EduRead. Todos los derechos reservados.</p>
</footer>
</div>
<script>
if(!localStorage.getItem('micTested')){
  window.location.href='microfono.html';
}
const canciones=[
  {titulo:'Manuelita la tortuga',
   letra:'Manuelita, viv\u00eda en Pehuaj\u00f3, pero un d\u00eda se march\u00f3. A Par\u00eds se fue a probar un poquito de rouge.'},
  {titulo:'Los Pollitos',
   letra:'Los pollitos dicen p\u00edo p\u00edo p\u00edo cuando tienen hambre cuando tienen fr\u00edo.'}
];
const select=document.getElementById('cancion');
canciones.forEach((c,i)=>{const o=document.createElement('option');o.value=i;o.textContent=c.titulo;select.appendChild(o);});
const letraCont=document.getElementById('letra');
let palabras=[];let indice=0;let rec;
function cargar(idx){
  const text=canciones[idx].letra.split(/\s+/);
  letraCont.innerHTML='';
  text.forEach(w=>{const s=document.createElement('span');s.className='word';s.textContent=w;letraCont.appendChild(s);letraCont.append(' ');});
  palabras=Array.from(letraCont.querySelectorAll('.word'));indice=0;
}
select.addEventListener('change',e=>cargar(e.target.value));
cargar(0);
function iniciar(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){alert('No soportado');return;}
  rec=new SR();rec.lang='es-ES';rec.continuous=true;
  rec.onresult=e=>{
    const t=e.results[e.results.length-1][0].transcript.toLowerCase();
    for(let i=indice;i<palabras.length;i++){
      const w=palabras[i].textContent.toLowerCase().replace(/[.,]/g,'');
      if(t.includes(w)){
        for(let j=indice;j<i;j++) palabras[j].classList.add('omission');
        palabras[i].classList.add('correct');
        indice=i+1;break;
      }
    }
  };
  rec.start();
}
function detener(){
  if(rec) rec.stop();
  for(let i=indice;i<palabras.length;i++) palabras[i].classList.add('omission');
}
document.getElementById('iniciar').addEventListener('click',()=>{
  document.getElementById('iniciar').classList.add('hidden');
  document.getElementById('finalizar').classList.remove('hidden');
  iniciar();
});
document.getElementById('finalizar').addEventListener('click',()=>{
  document.getElementById('finalizar').classList.add('hidden');
  detener();
});
</script>
</body>
</html>